
@{
    ViewBag.Title = "Calculate";
}
<style>
    .error {
        border: 2px solid yellow;
    }

    textarea {
        /* box-sizing: padding-box; */
        overflow: auto;
        /* demo only: */
        padding: 10px;
        width: 250px;
        font-size: 14px;
        display: block;
        border-radius: 10px;
        border: 6px solid #556677;
    }

    .cost-info {
        padding: 7px;
        font-size: 22px;
    }
</style>
<div class="container">
    <div class="well">
        <template id="product-template">
            <div class="alert alert-info" style="background:  #455A64">
                <input style="background: #fff8e1 " type="button" class="btn btn-default" data-bind="value: isCreateProductClick.text, click: createProductForm" />
                <input type="text" class="input-lg" data-bind="visible:isCreateProductClick, value: newProductName" placeholder="название" />
                <div class="" style="float: right"><a href="~/Recipe/Index" style="color: antiquewhite">Рецепты</a></div>
            </div>

            <div data-bind="foreach: products">
                <div style="padding: 7px;border-bottom:1px solid #455A64" data-toggle="collapse" data-bind="attr: { 'data-target': '#Yes' + $index() }, style:{background: isNewOrUpdatedProduct()? '#FF5252' : '#454545' }">
                    <strong  style="color: aliceblue; font-size: 18px;" data-toggle="collapse" data-bind="text:name"></strong>
                 <strong style="float: right; color: aliceblue; font-size: 12px;" data-bind="text: lastChangeDate"></strong>
                </div>
                <div class="collapse in" data-bind="attr: { id: 'Yes' + $index() }">
                    <div>
                        <a href="#" class="glyphicon glyphicon-floppy-disk" data-toggle="tooltip" title="сохранить" data-bind="click: $parent.saveProduct, visible:isNewOrUpdatedProduct"></a>
                        <!--ko ifnot:isEdit-->
                        <a href="#" class="glyphicon glyphicon-edit" data-toggle="tooltip" title="редактировать" data-bind="click: $parent.editProduct"></a>
                        <!--/ko-->
                        <!--ko if:isEdit-->
                        <a href="#" style="float: right" class="glyphicon glyphicon-remove" data-bind="click: $parent.removeProduct"></a>
                        <!--/ko-->
                    </div>
                    <div data-bind="css:{ 'alert-danger':isNewOrUpdatedProduct}" class="alert alert-success">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="form-horizontal" data-bind="foreach: ingridients">
                                    <div class="row">
                                        <div data-bind="visible: ProcessFlag() != 3">
                                            <div class="col-md-3">
                                                <input class="input-sm" data-toggle="tooltip" title="ингридиент" type="text" placeholder="название" data-bind="enable:$parent.isEdit, value: Name">
                                            </div>
                                            <div class="col-md-3">
                                                <input class="input-sm" data-bind="attr:{type: InputType, placeholder: InputType.placeholder},enable:$parent.isEdit, value: Weight ,valueUpdate: 'afterkeydown' , css:{error:Weight.hasError, 'col-md-6': $parent.isEdit, 'col-md-12':!$parent.isEdit}" />
                                                <select class="col-md-6" data-bind="visible:$parent.isEdit, options:$parents[1].weightOptions, optionsText: 'typeName', optionsValue:'typeValue', value:InputType"></select>
                                                @*<span data-bind="visible: Weight.hasError, text: Weight.validationMessage"></span>*@
                                            </div>
                                            <div class="col-md-4">
                                                <input class="input-sm" type="text" data-toggle="popover" title="цена(ед)" placeholder="цена (ед)" data-bind="enable:$parent.isEdit, value: Cost , valueUpdate : 'afterkeydown', css:{error:Cost.hasError}" />
                                                <span data-bind="visible: Cost.hasError, text: Cost.validationMessage"></span>
                                                <a href="#" class="glyphicon glyphicon-minus" data-toggle="tooltip" data-placement="right" title="удалить" data-bind="visible:$parent.isEdit, click:$component.removeIngridient"></a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="">
                                    <input class="form-control" type="number" placeholder="кол-во изделий(порций)" data-bind="visible:isEdit, value: total, css:{error:total.hasError}"/>
                                    <p class="control-label" data-bind="visible: total.hasError, text: total.validationMessage"></p>
                                    <div class="cost-info col-sm-4">
                                        <a href="#" class="glyphicon" data-bind="visible:isEdit , click:$component.addIngridient">+</a>
                                        <span class="" data-bind="visible: !total.hasError(), text:cost.showText"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <a class="col-md-12" href="#" data-bind="click:$parent.showDescription, text:isDescription.text"></a>
                                <textarea cols="100"  rows="8" class="form-control" data-bind="visible: isDescription, enable: isEdit ,value: description"></textarea>
                            </div>
                        </div>
                    </div>
                    <!--ko if:isEdit-->
                    <input type="button" data-bind="click:$parent.calcSum" value="расчитать" />
                    <!--/ko-->
                    <hr />
                </div>
            </div>
        </template>
        <products params="" data-bind="visible: true"></products>
    </div>
</div>


@section scripts{
    @Scripts.Render("/Scripts/models/product-view-model.js")
    <script>

        $(document).ready(function () {
            ko.applyBindings();
        });

    </script>
}







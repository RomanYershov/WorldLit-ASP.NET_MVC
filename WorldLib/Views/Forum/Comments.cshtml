@using System.Web.UI.WebControls
@using WebGrease.Css.Extensions
@using WorldLib.Models
@model CommentsByDiscussionViewModel
@{
    ViewBag.Title = "Comments";
}

<div class="container">
    <div class="panel panel-primary" style="border:none" id="panel-container">
        <div class="panel-heading text-center" onclick="blockClick()" id="block-disc">

            @if (Model.Discussion != null)
            {
                <h4>@Model.Discussion.Name</h4>

            }
            else
            {
                <h4>В этом обсуждении пока отсутствуют комментарии ..</h4>
            }

        </div>
        <div class="panel-body" style="background-color:#555555;">
            <div class="row">
                <div class="col-md-12">
                    <div id="results">
                        @foreach (var comment in Model.Comments)
                        {

                            <div id="comment" class="alert-success alert ">
                                <span class="text-muted">@comment.Text</span>
                                <div style="padding: 20px 0 5px 14px">
                                    <small style="float: right;" class=" text-muted">@comment.User.NikName</small>
                                    <small style="float: left;" class="text-muted">@string.Format(" {0} ~ {1} ", comment.CreationDateTime.ToLongDateString(), comment.CreationDateTime.ToShortTimeString())</small>
                                </div>
                            </div>

                        }
                    </div>
                    @if (User.Identity.IsAuthenticated)
                    {
                        <form method="post" action="/Forum/AddComment" id="add-comment">
                            <textarea name="Text" rows="4" cols="40"  class="form-control" id="text-comment"></textarea>
                            <input type="hidden" name="DiscussionId" value="@Model.Discussion.Id" />
                            <input class="btn btn-block btn-primary" type="submit" value="добавить" />
                        </form>


                    }
                </div>
                @*<div class="col-md-4 text-center">
                        @{Html.RenderPartial("CategoriesPartialView", ViewBag.CategoriesList as List<Category>);}
                    </div>*@
            </div>
        </div>

    </div>
</div>


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

  
    <script>

        $('#add-comment').submit(function (e) {
            var form = $(this);
            var url = form.attr('action');

            $.ajax({
                type: "POSt",
                url: url,
                data: form.serialize(),
                success: function (data) {
                    $('#text-comment').val('');
                    swal({
                        title: "Спасибо за ваш отзыв",
                        text: data,
                        icon: "info",
                        buttons: false,
                        timer: 4500
                    });
                }
            });
            e.preventDefault();
        });


        var block = document.getElementById('block-disc');
        function blockClick() {
            window.location.href = "../../Forum/Index";
        };

    </script>



}

<style>
    #block-disc {
        background-color: #555555;
        cursor: pointer;
        color: darkgray;
    }

        #block-disc:hover {
            /*background-color:#777;*/
            color: white;
            /*box-shadow: 0px 15px 10px -15px #111;*/
        }
    #comment {
        margin-bottom: 1px;
        background-color: #424242;
    }
    /*#panel-container {
        box-shadow: -15px 0px 5px -15px #111;
    }*/
</style>




